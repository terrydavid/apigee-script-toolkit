#!/bin/bash

# getSFlowRevisions
#
# retrieves the revision number of all revisions of a SharedFlow
#
# usage:
#   getSFlowRevisions sharedflown_ame

USAGE="sharedflow_name name"
TOOLSDIR="${APITOOLS_HOME}"
. "$TOOLSDIR/lib/functions"
parseCommandline "$@"
checkArgs 1

[[ $DEBUG -gt 4 ]] && set -x

SFName=${ARGS[0]}

if [ "$SFName" = "" ]; then
	usefail "no API name specified"
fi

# force json for now
FRMT=json

# /o/{ORGANIZATION}/sharedflows/{sharedflow_name}/deployments

URL="${APIGEE_HOST}/o/${ORGANIZATION}/sharedflows/${SFName}"
debug "retrieving API ${APNAME} versions from ${URL}"

http_get "$URL"

if [ "$STATUS_CODE" != "200" ]; then
	fail "$(basename "$0") failed with status $STATUS_CODE: $RESPONSE"
fi

#JLIST=`echo "$RESPONSE" | sed 's/[\[\]\"\,\:a-zA-Z]*//g'`
JLIST=`echo "$RESPONSE" | $TOOLSDIR/lib/jp.sh | jsonValueOf "revision"`
#debug "JLIST: \n$JLIST"

#APILIST=`echo "$RESPONSE" | awk 'BEGIN { RS = "[\n\r]+" } ; /revision.*,0,.*name/ {print $2}'`
#debug "APILIST=$APILIST"
#for a in $JLIST ; do printf "%b\n" $a ; done

for a in $JLIST ; do printf "%b\n" $a | sed 's/\"//g' ; done

set -
