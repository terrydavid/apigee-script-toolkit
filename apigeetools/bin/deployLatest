#!/bin/bash
 
# deployLatest
#
# deploys the latest version of an API to an environment
# (This script will undeploy any deployed versions of an API before deploying the latest version)
#
# usage:
#   deployLatest environment api

#set -e

USAGE="api"
TOOLSDIR="${APITOOLS_HOME}"
. "$TOOLSDIR/lib/functions"
parseCommandline "$@"
checkArgs 2 2

APINAME=${ARGS[0]}
if [ "$APINAME" = "" ]; then
	usefail "no API name specified"
fi

deployed=`getApiRevisionDeployed ${OPTS[@]} "$APINAME"`
latest=`getApiRevisionLatest ${OPTS[@]} "$APINAME"`

if [ "$deployed" == "$latest" ]; then
	echo "version $deployed of API $APINAME is already deployed to environment $ENVIRONMENT"
else 
#	undeployApi ${OPTS[@]} "$APINAME"
	deployApi ${OPTS[@]} "$APINAME" "latest"
fi
