#!/bin/bash

# listApis
#
# lists the apis contained in a given host
#
# usage:
#   getApis host_alias

#set -e

USAGE="host_alias  # ouput is simple list"
TOOLSDIR="${APITOOLS_HOME}"

. "$TOOLSDIR/lib/functions"

parseCommandline "$@"
loadConfig "${ARGS[0]}"

URL="${APIGEE_HOST}/o/${ORGANIZATION}/apis"
debug "retrieving APIs from ${URL}"

http_get "$URL"

if [ "$STATUS_CODE" != "200" ]; then
	fail "$(basename "$0") failed with status $STATUS_CODE: $RESPONSE"
fi

if [ "$FRMT" = "json" ] ; then
	APILIST=`echo "$RESPONSE" | sed -e 's/[",]//g'`  # -e 's/[[\]]//g'
else
	APILIST=`echo "$RESPONSE" | xmlValueOf "Item"`
fi

debug "APILIST=$APILIST"

for a in $APILIST ; do printf "%b\n" $a | sed -e 's/[",\[]//g' -e 's/\]//g' ; done
