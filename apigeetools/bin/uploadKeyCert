#!/bin/bash

# uploadKeyCrt
#
# Uploads a Key and Cert pair to a keystore in an environment
#
# usage:
#   uploadKeyCrt keystore_name key_alias keyFile keycertfile key_pword

#set -e

USAGE="keystore_name key_alias keyFile keycertfile key_pword"
TOOLSDIR="${APITOOLS_HOME}"

. "$TOOLSDIR/lib/functions"

parseCommandline "$@"
checkArgs 4
loadConfig 

keystore_name="${ARGS[0]}"
alias_name="${ARGS[1]}"
KEYFILE="${ARGS[2]}"
KEYCERTFILE="${ARGS[3]}"
key_pword="${ARGS[4]}"
IFPWSD="-F password=\"${key_pword}\""

#URL="${APIGEE_HOST}/v1/o/${ORGANIZATION}/e/${ENVIRONMENT}/keystores"
URL="${APIGEE_HOST}/v1/o/${ORGANIZATION}/e/${ENVIRONMENT}/keystores/${keystore_name}/aliases?alias=${alias_name}&format=keycertfile"

curlOPTS="-H \"Content-Type: multipart/form-data\" -F keyFile=\"@${KEYFILE}\" -F certFile=\"@${KEYCERTFILE}\" ${IFPSWD}"


debug "loading key \& cert to ${URL}"

http_post "$URL"

echo "$RESPONSE" | sort
# | "$TOOLSDIR/lib/json.sh" | cut -f 3- -d " "
