#!/bin/bash
 
# downloadApi
#
# downloads an API bundle
#
# usage:
#   dlApi host_alias api [zip_file]
#       api the name of the api
#       zip_file the name of the apiproxy zip file (default is ./apiproxy.zip) to create

USAGE="api [revision] [zip_file] # 'download (export)' a .zip file as the name 'api'"
TOOLSDIR="${APITOOLS_HOME}"
. "$TOOLSDIR/lib/functions"
parseCommandline "$@"
checkArgs 2 4

[[ ${DEBUG} -ge 4 ]] && set -x

APINAME="${ARGS[0]}"
REV="${ARGS[1]}"
FNAME="${ARGS[2]}"

URL="${APIGEE_HOST}/o/${ORGANIZATION}/apis/${APINAME}/revisions/${REV}?format=bundle"

debug "Downloading API ${APINAME}-${REV}.zip via ${URL}"

FRMT=json

#HDRS="-H Content-Type:application/octet-stream"
# No need for version # if using git
if [ "$REV" != "" ] ; then
	curlOPTS=" --output ${APISDIR}/${APINAME}-${REV}.zip "
else
	curlOPTS=" --output ${APISDIR}/${APINAME}.zip "
fi

debug "curlOPTS= $curlOPTS"
http_get "$URL"

#echo -e "\tDownloaded version $REV of API $APINAME to ${APISDIR}/${APINAME}-${REV}.zip"
