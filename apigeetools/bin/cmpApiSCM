#!/bin/bash

# cmpApiVersions
#
# !!! THIS VERSION IS 'GUARDIAN' ONLY !!!

# usage:
#   cmpApiVersions environment ApiProxyNameset -e

USAGE="apiproxyname revision GITAPI"
TOOLSDIR="${APITOOLS_HOME}"

. "$TOOLSDIR/lib/functions"

parseCommandline "$@"
checkArgs 3 

[ "_$DEBUG" == "_2" ] && set -x

API="${ARGS[0]}"; GAPI=$API
REV="${ARGS[1]}"
[ ${ARGS[2]} ] && GAPI="${ARGS[2]}"

if [ "_$REV" == "_Latest" ] ; then
	REV=`getApiVersionLatest "${OPTS[@]}" "$API"`
fi

dlApi ${OPTS[@]} "$API" "$REV" "$API"-"$REV".zip 2>/dev/null
unzip -oq $API-$REV.zip -d $API-$REV 2>&1 >/dev/null
debug diff -br "$API-$REV/" "$APISDIR/$API/"
diff -br "$API-$REV/" "$HOME/git/guardian/apis/$GAPI/"
[ "_$?" == "_0" ] && echo " Proxies are the same"

